<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Phaser - BeeApple</title>
    <script src="//cdn.jsdelivr.net/phaser/2.2.2/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(600, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {

	game.load.image('bee','bee.png');
	game.load.image('bearface','bearface.png');
	game.load.image('bearback','bearback.png');
	game.load.image('bearface2','bearface2.png');
	game.load.image('bearback2','bearback2.png');
	game.load.image('apple','apple.png');
	game.load.image('background','background.jpg');

}
var bears=[];
var bee;
var apples;
var cursors;
var gameStop = false;
var scoreText;
var score=0;

function create() {

	game.physics.startSystem(Phaser.Physics.ARCADE);
	game.add.sprite(0,0,'background');
	bears.push(game.add.sprite(10,10,'bearface'));
	bears.push(game.add.sprite(game.world.width-130,10,'bearface2'));
	bears.push(game.add.sprite(10,game.world.height-140,'bearback'));
	bears.push(game.add.sprite(game.world.width-130,game.world.height-140,'bearback2'));
	for(var i=0;i<4;i++){
		bears[i].width=120;
		bears[i].height=130;
	}
	bee=game.add.sprite(300,300,'bee');
	game.physics.arcade.enable(bee);
	bee.body.collideWorldBounds = true;
	apples = game.add.group();
	apples.enableBody=true;
	cursors = game.input.keyboard.createCursorKeys();

	scoreText = game.add.text(250,16,'Очки: 0',{fontSize:'32px',fill:'#AFEEEE'});

}

function update() {
	if(!gameStop){
		game.physics.arcade.overlap(bee, apples, gameOver, null, this);

		bee.body.velocity.x=0;
		bee.body.velocity.y=0;
		if(cursors.left.isDown){
			bee.body.velocity.x=-150;
		}else if(cursors.right.isDown){
			bee.body.velocity.x=150;
		}
		if(cursors.up.isDown){
			bee.body.velocity.y=-150;
		}else if(cursors.down.isDown){
			bee.body.velocity.y=150;
		}
		if(Math.random()<0.03){
			bearThrow(Math.round(Math.random()*3));
			score++;
			scoreText.text = 'Очки: '+score;
		}
	}
	
}
function bearThrow(i){
	var apple =apples.create(bears[i].x+60,bears[i].y+65,'apple');
	apple.width=40;
	apple.height=40;
	apple.body.velocity.y=100*Math.sin(3.14/2-Math.atan2(bee.x+bee.width/2-bears[i].x-80,bee.y+bee.height/2-bears[i].y-85));
	apple.body.velocity.x=100*Math.cos(3.14/2-Math.atan2(bee.x+bee.width/2-bears[i].x-80,bee.y+bee.height/2-bears[i].y-85));
}
function gameOver(bee,apple){
	bee.body.velocity.x=0;
	bee.body.velocity.y=0;
	gameStop=true;
	bee.kill();
	scoreText.text = 'Очки: '+score+' Игра окончена';
}


</script>

</body>
</html>